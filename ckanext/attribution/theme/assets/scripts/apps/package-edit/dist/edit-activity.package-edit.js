(window.webpackJsonppackage_edit=window.webpackJsonppackage_edit||[]).push([[1],{81:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"activity-edit-block"},[i("div",{staticClass:"activity-edit-fields attribution-row"},[i("select-field",{attrs:{options:Object.keys(t.controlledLists.activityTypes)},on:{input:function(e){return t.getOptions(t.edits.scheme)}},model:{value:t.edits.scheme,callback:function(e){t.$set(t.edits,"scheme",e)},expression:"edits.scheme"}},[t._v("\n            Role scheme\n        ")]),t._v(" "),t.edits.scheme?i("select-field",{attrs:{options:t.activityOptions,"opt-value":function(t){return t.name},"opt-label":function(t){return t.name}},on:{input:t.getAgents},model:{value:t.edits.activity,callback:function(e){t.$set(t.edits,"activity",e)},expression:"edits.activity"}},[t._v("\n            Contribution role\n        ")]):t._e(),t._v(" "),i("select-field",{attrs:{options:t.controlledLists.activityLevels},model:{value:t.edits.level,callback:function(e){t.$set(t.edits,"level",e)},expression:"edits.level"}},[t._v("\n            Contribution level\n        ")]),t._v(" "),i("div",{staticClass:"attribution"},[i("datefield",{attrs:{placeholder:"Select date (optional)"},model:{value:t.edits.time,callback:function(e){t.$set(t.edits,"time",e)},expression:"edits.time"}},[t._v("\n                Contribution date\n            ")])],1)],1),t._v(" "),i("div",{staticClass:"expand-bar",attrs:{title:"Expand"},on:{click:function(e){t.expand=!t.expand}}},[i("i",{staticClass:"fas",class:t.expand?"fa-caret-up":"fa-caret-down"}),t._v(" "),i("small",[t._v("Advanced options")]),t._v(" "),i("i",{staticClass:"fas",class:t.expand?"fa-caret-up":"fa-caret-down"})]),t._v(" "),t.expand?[i("div",{staticClass:"activity-sorted-agents attribution-row"},[t._m(0),t._v(" "),t._m(1),t._v(" "),i("draggable",{attrs:{group:"allAgents"},on:{change:t.updateOrder},model:{value:t.sortedAgents,callback:function(e){t.sortedAgents=e},expression:"sortedAgents"}},t._l(t.sortedAgents,(function(e){return i("div",{staticClass:"activity-agent",class:e.id===t.activityId?"active-agent":""},[i("i",{staticClass:"fas fa-arrows"}),t._v(" "),i("span",[t._v(t._s(e.name))]),t._v(" "),i("span",[t._v(t._s(e.order))])])})),0)],1),t._v(" "),i("div",{staticClass:"activity-unsorted-agents attribution-row"},[t._m(2),t._v(" "),t._m(3),t._v(" "),i("draggable",{attrs:{group:"allAgents"},on:{change:t.updateOrder},model:{value:t.unsortedAgents,callback:function(e){t.unsortedAgents=e},expression:"unsortedAgents"}},t._l(t.unsortedAgents,(function(e){return i("div",{staticClass:"activity-agent",class:e.id===t.activityId?"active-agent":""},[i("i",{staticClass:"fas fa-arrows"}),t._v(" "),i("span",[t._v(t._s(e.name))]),t._v(" "),i("span",[t._v(t._s(e.order))])])})),0)],1)]:t._e(),t._v(" "),t.activity.meta.is_temporary?t._e():i("div",{staticClass:"attribution-save"},[i("span",{staticClass:"btn",class:t.isValid?"btn-primary":"btn-disabled",on:{click:t.saveChanges}},[i("i",{staticClass:"fas fa-save"}),t._v("\n            Save changes\n        ")]),t._v(" "),i("span",{staticClass:"btn btn-primary",on:{click:function(e){return t.$emit("toggle-edit","cancel")}}},[i("i",{staticClass:"fas fa-times"}),t._v("\n            Cancel\n        ")])])],2)};n._withStripped=!0;var s=i(4),a=i(31),r=i.n(a),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:t.classes},[i("label",{attrs:{for:t.fieldId}},[t._t("default")],2),t._v(" "),i("input",{staticClass:"form-control",attrs:{type:"date",id:t.fieldId,placeholder:t.placeholder},domProps:{value:t.dateOnly},on:{change:t.setValue}})])};c._withStripped=!0;var o={name:"DateField",extends:i(12).a,props:["placeholder"],computed:{dateOnly:function(){if(this.value)try{return new Date(this.value).toISOString().split("T")[0]}catch(t){return this.value}}}},l=i(1),d=Object(l.a)(o,c,[],!1,null,null,null);d.options.__file="src/components/fields/DateField.vue";var u=d.exports,v=i(20),p=i(10);function f(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function h(t){for(var e,i=1;i<arguments.length;i++)e=null==arguments[i]?{}:arguments[i],i%2?f(Object(e),!0).forEach((function(i){g(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):f(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}));return t}function g(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var y={name:"EditActivity",extends:v.a,props:{activityId:String,canSave:{default:function(){return!0}}},components:{draggable:r.a,datefield:u},data:function(){return{edits:{},activityOptions:[],sortedAgents:[],unsortedAgents:[],expand:!1}},computed:h(h({},Object(s.e)(["controlledLists","packageId"])),{},{activity:function(){return p.a.query().with("meta").with("agent").find(this.activityId)},contributor:function(){return this.activity.agent},isValid:function(){return this.canSave&&null!==this.edits.activity}}),methods:{getAgents:function(t){this.$set(this.edits,"activity",t);var e=p.a.query().with("agent").where("activity",this.edits.activity).orderBy((function(t){return t.order})).get().map((function(t){return{name:t.agent.displayName,id:t.id,order:t.order}}));this.sortedAgents=e.filter((function(t){return null!==t.order})),this.unsortedAgents=e.filter((function(t){return null===t.order})),this.activity.activity!==this.edits.activity&&this.unsortedAgents.push({name:this.contributor.displayName,id:null,order:null})},getOptions:function(t){var e=this;return new Promise((function(i){t||(e.activityOptions=[],i());var n=e.contributor.activities.filter((function(i){return i.id!==e.activityId&&i.scheme===t})).map((function(t){return t.activity}));e.activityOptions=e.controlledLists.activityTypes[t].filter((function(t){return!n.includes(t.name)})),i()}))},updateOrder:function(){var t=this;this.sortedAgents=this.sortedAgents.map((function(e,i){return e.order=i+1,e.id===t.activityId&&t.$set(t.edits,"order",i+1),e})),this.unsortedAgents=this.unsortedAgents.map((function(e){return e.order=null,e.id===t.activityId&&t.$set(t.edits,"order",null),e}))},saveChanges:function(){var t=this;if(this.isValid){var e=[p.a.update({where:this.activityId,data:this.edits}).then((function(){return p.a.updateMeta(t.activityId,{is_dirty:!0,is_editing:!1})}))];return this.sortedAgents.concat(this.unsortedAgents).forEach((function(t){t.id&&e.push(p.a.update({where:t.id,data:{order:t.order}}).then((function(){return p.a.updateMeta(t.id,{is_dirty:!0})})))})),Promise.all(e).then((function(){t.$emit("toggle-edit","save")})).catch((function(t){return console.error(t)}))}},refresh:function(){var t=this;this.getOptions(this.activity.scheme).then((function(){t.edits=t.activity.getCopy(),t.edits.activity&&t.getAgents(t.edits.activity)}))}},created:function(){var t=this;this.refresh(),this.eventBus.$on(this.events.saveActivity,(function(e){e===t.activityId&&t.saveChanges()}))},watch:{activityId:function(){this.refresh()},isValid:function(t){this.$emit("validated",t)}}},_=Object(l.a)(y,n,[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b",[t._v("Ordered contributors")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"help-icon"},[i("i",{staticClass:"fas fa-question-circle"}),t._v(" "),i("div",{staticClass:"help-tooltip",attrs:{role:"tooltip"}},[t._v("\n                    Contributors that should be listed in a particular order when citing.\n                ")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b",[t._v("Unordered contributors")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"help-icon"},[i("i",{staticClass:"fas fa-question-circle"}),t._v(" "),i("div",{staticClass:"help-tooltip",attrs:{role:"tooltip"}},[t._v("\n                    Contributors that do not have to be listed in any particular order. These will be listed\n                    "),i("em",[t._v("after")]),t._v(" the ordered contributors.\n                ")])])}],!1,null,null,null);_.options.__file="src/components/EditActivity.vue";e.default=_.exports}}]);