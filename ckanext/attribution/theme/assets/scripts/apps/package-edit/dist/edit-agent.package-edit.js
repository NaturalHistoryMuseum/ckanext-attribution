(window.webpackJsonppackage_edit=window.webpackJsonppackage_edit||[]).push([[1],{73:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"agent-edit-block agent-detail",class:"agent-"+e.edits.agent_type.toLowerCase()},[i("div",{staticClass:"agent-header"},[i("AgentTypeField",{model:{value:e.edits.agent_type,callback:function(t){e.$set(e.edits,"agent_type",t)},expression:"edits.agent_type"}}),e._v(" "),i("span",{staticClass:"display-name"},[i("em",[e._v(e._s(e.displayName))])]),e._v(" "),i("div",{staticClass:"edit-icons"},[e.contributor.external_id?i("span",{staticClass:"edit-icon",attrs:{title:"Download contributor details from external source"},on:{click:e.syncAgent}},[i("i",{staticClass:"fas",class:e.contributor.meta.syncing?"fa-spinner fa-spin":"fa-arrow-alt-circle-down"})]):e._e(),e._v(" "),e.canEdit?i("span",{staticClass:"edit-icon",attrs:{title:"Edit"},on:{click:function(t){return e.$emit("toggle-edit")}}},[i("i",{staticClass:"fas fa-edit"})]):e._e(),e._v(" "),i("span",{staticClass:"edit-icon",attrs:{title:"Remove this contributor"},on:{click:function(t){return e.eventBus.$emit(e.events.removeContributor,e.contributorId)}}},[i("i",{staticClass:"fas fa-minus-circle"})])])],1),e._v(" "),i("div",{staticClass:"agent-id-edit attribution-row"},[i("select-field",{class:["wrap-small"],attrs:{options:Object.entries(e.controlledLists.agentIdSchemes),"opt-label":function(e){return e[1].label},"opt-value":function(e){return e[0]}},model:{value:e.edits.external_id_scheme,callback:function(t){e.$set(e.edits,"external_id_scheme",t)},expression:"edits.external_id_scheme"}},[e._v("\n            External ID scheme\n        ")]),e._v(" "),i("text-field",{class:["wrap-small"],attrs:{placeholder:e.controlledLists.agentIdSchemes[e.edits.external_id_scheme].label},model:{value:e.edits.external_id,callback:function(t){e.$set(e.edits,"external_id",t)},expression:"edits.external_id"}},[i("i",{class:e.controlledLists.agentIdSchemes[e.edits.external_id_scheme].fa_icon}),e._v("\n            "+e._s(e.controlledLists.agentIdSchemes[e.edits.external_id_scheme].label)+"\n        ")])],1),e._v(" "),i("div",{staticClass:"expand-bar",attrs:{title:"Expand"},on:{click:function(t){e.expand=!e.expand}}},[i("small",[e._v("Show all edit options")]),e._v(" "),i("i",{staticClass:"fas",class:e.expand?"fa-caret-up":"fa-caret-down"})]),e._v(" "),e.expand?[i("div",{staticClass:"agent-name-edit attribution-row"},["person"===e.edits.agent_type?[i("text-field",{attrs:{cls:["wrap-small"]},model:{value:e.edits.family_name,callback:function(t){e.$set(e.edits,"family_name",t)},expression:"edits.family_name"}},[e._v("\n                    Family name\n                ")]),e._v(" "),i("text-field",{attrs:{cls:["wrap-small"]},model:{value:e.edits.given_names,callback:function(t){e.$set(e.edits,"given_names",t)},expression:"edits.given_names"}},[e._v("\n                    Given name(s)\n                ")]),e._v(" "),e._l(e.idGen,(function(t){return i("div",{staticClass:"attribution-field one-line"},[i("label",{attrs:{for:t}},[e._v("\n                        Given names first\n                    ")]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.edits.given_names_first,expression:"edits.given_names_first"}],attrs:{id:t,type:"checkbox"},domProps:{checked:Array.isArray(e.edits.given_names_first)?e._i(e.edits.given_names_first,null)>-1:e.edits.given_names_first},on:{change:function(t){var i=e.edits.given_names_first,n=t.target,s=!!n.checked;if(Array.isArray(i)){var a=e._i(i,null);n.checked?a<0&&e.$set(e.edits,"given_names_first",i.concat([null])):a>-1&&e.$set(e.edits,"given_names_first",i.slice(0,a).concat(i.slice(a+1)))}else e.$set(e.edits,"given_names_first",s)}}})])})),e._v(" "),i("help-tooltip",[e._v("\n                    Does this person's culture or language typically place given or family\n                    names first? (this does not affect sorting)\n                ")])]:e._e(),e._v(" "),"person"!==e.edits.agent_type?[i("text-field",{model:{value:e.edits.name,callback:function(t){e.$set(e.edits,"name",t)},expression:"edits.name"}},[e._v("\n                    Name\n                ")]),e._v(" "),i("text-field",{model:{value:e.edits.location,callback:function(t){e.$set(e.edits,"location",t)},expression:"edits.location"}},[e._v("\n                    Location\n                ")])]:e._e()],2),e._v(" "),i("div",{staticClass:"agent-user-edit attribution-row"},[i("autocomplete-field",{attrs:{options:e.userOptions,label:"Associated user","item-id":"agent-user-"+e.contributorId},on:{typing:e.updateUserOptions},model:{value:e.edits.user_id,callback:function(t){e.$set(e.edits,"user_id",t)},expression:"edits.user_id"}}),e._v(" "),i("help-tooltip",[e._v("\n                If this contributor has a user account registered on the portal, associate it here\n            ")])],1),e._v(" "),i("div",{staticClass:"agent-affiliations-edit attribution-row"},[i("autocomplete-list",{attrs:{options:e.affiliationOptions,label:"Add affiliation","item-id":"agent-affiliation-"+e.contributorId},on:{typing:e.updateAffiliationOptions},model:{value:e.affiliations,callback:function(t){e.affiliations=t},expression:"affiliations"}}),e._v(" "),i("help-tooltip",[e._v("\n                For affiliations that are associated with "),i("em",[e._v("this package only")]),e._v(". Only includes contributors\n                that have already been added to this page.\n            ")])],1)]:e._e(),e._v(" "),i("div",{staticClass:"attribution-save"},[i("span",{staticClass:"btn btn-primary",on:{click:e.saveChanges}},[i("i",{staticClass:"fas fa-save"}),e._v("\n            Save changes\n        ")]),e._v(" "),i("span",{staticClass:"btn btn-primary",on:{click:function(t){return e.$emit("toggle-edit")}}},[i("i",{staticClass:"fas fa-times"}),e._v("\n            Cancel\n        ")])])],2)};n._withStripped=!0;var s=i(3),a=i(7),r=i(34),o=i(25),l=i(0),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"agent-type-edit",class:e.classes},e._l(e.options,(function(t,n){return i("span",{staticClass:"agent-type-option"},[i("input",{attrs:{type:"radio",id:e.optionId(n)},domProps:{value:n,checked:e.value===n},on:{change:e.setValue}}),e._v(" "),i("label",{attrs:{for:e.optionId(n)}},[i("i",{class:t.fa_icon})])])})),0)};function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function u(e){for(var t,i=1;i<arguments.length;i++)t=null==arguments[i]?{}:arguments[i],i%2?d(Object(t),!0).forEach((function(i){f(e,i,t[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}));return e}function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}c._withStripped=!0;var p={name:"AgentTypeField",extends:i(13).a,computed:u(u({},Object(s.e)(["controlledLists"])),{},{options:function(){return this.controlledLists.agentTypes}}),methods:{optionId:function(e){return"agent-type-option-"+e+this.fieldId}}},_=i(1),h=Object(_.a)(p,c,[],!1,null,null,null);h.options.__file="src/components/fields/AgentTypeField.vue";var m=h.exports;function v(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function g(e){for(var t,i=1;i<arguments.length;i++)t=null==arguments[i]?{}:arguments[i],i%2?v(Object(t),!0).forEach((function(i){b(e,i,t[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}));return e}function b(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var y={name:"EditAgent",extends:o.a,components:{AgentTypeField:m},data:function(){return{edits:{},affiliations:[],expand:!1,userOptions:[],affiliationOptions:[],syncing:!1}},computed:g(g({},Object(s.e)(["canEdit","packageId","controlledLists"])),{},{contributor:function(){return l.c.query().with("meta").with("affiliations.other_agent").with("affiliations.meta").find(this.contributorId)},displayName:function(){return"person"===this.edits.agent_type?this.edits.given_names_first?[this.edits.given_names,this.edits.family_name].join(" "):[this.edits.family_name,this.edits.given_names].join(" "):this.edits.name},idGen:function(){return[Object(r.a)(8)]}}),methods:g(g({},Object(s.b)(["removeContributor"])),{},{saveChanges:function(){var e=this,t=[],i=this.affiliations.filter((function(t){return-1===e.contributor.affiliations.findIndex((function(e){return e.other_agent_id===t.value}))})).map((function(i){var n={agent_id:e.contributorId,other_agent_id:i.value,package_id:e.packageId,meta:{is_new:!0}};return l.c.query().where("id",i.value).exists()||(i.record.meta={is_new:!0},t.push(l.c.insert({data:i.record}))),n}));return t.push(l.b.insert({data:i})),this.contributor.affiliations.filter((function(t){return-1===e.affiliations.findIndex((function(e){return e.value===t.other_agent_id}))})).forEach((function(e){t.push(l.b.updateMeta(e.id,{to_delete:!0}))})),t.push(l.c.update({where:this.contributorId,data:this.edits})),Promise.all(t).then((function(){return l.c.updateMeta(e.contributorId,{is_dirty:!0})})).then((function(){e.$emit("toggle-edit")})).catch((function(e){return console.error(e)}))},updateUserOptions:function(e){var t=this;return""===e||null===e?void(this.userOptions=[]):void Object(a.b)("user_list?q="+e).then((function(e){t.userOptions=e.map((function(e){return{label:e.display_name,value:e.id}}))}))},updateAffiliationOptions:function(e){var t=this,i=l.c.query().where("isActive",!0).where((function(e){return e.id!==t.contributorId})).where((function(e){return-1===t.affiliations.findIndex((function(t){return t.value===e.id}))}));e&&""!==e&&(i=i.where((function(t){var i=e.toLowerCase(),n=!!t.family_name&&t.family_name.toLowerCase().startsWith(i),s=!!t.given_names&&t.given_names.toLowerCase().startsWith(i),a=!!t.name&&t.name.toLowerCase().startsWith(i);return n||s||a}))),this.affiliationOptions=i.get().map((function(e){return{label:e.displayName,value:e.id,record:e}}))},syncAgent:function(){this.$store.dispatch("syncAgent",this.contributorId).then(this.refresh)},refresh:function(){var e=this;if(this.edits=this.contributor.getCopy(),this.affiliations=this.contributor.affiliations.filter((function(e){return!e.meta.to_delete})).map((function(e){return{label:e.other_agent.displayName,value:e.other_agent_id,record:e.other_agent}})),this.edits.agent_type||this.edits.external_id_scheme||this.$set(this.edits,"agent_type",Object.keys(this.controlledLists.agentTypes)[0]),!this.edits.agent_type&&this.edits.external_id_scheme){var t=Object.entries(this.controlledLists.agentTypes).filter((function(t){return t[1].default===e.edits.external_id_scheme}));0<t.length&&this.$set(this.edits,"agent_type",t[0][0])}this.edits.external_id_scheme||this.$set(this.edits,"external_id_scheme",this.controlledLists.agentTypes[this.edits.agent_type].default_scheme),void 0===this.edits.given_names_first&&this.$set(this.edits,"given_names_first",!0),this.edits.user_id&&Object(a.b)("user_show?id="+this.edits.user_id).then((function(t){e.userOptions=[{label:t.display_name,value:e.edits.user_id}]}))}}),created:function(){this.refresh()}},O=Object(_.a)(y,n,[],!1,null,null,null);O.options.__file="src/components/EditAgent.vue";t.default=O.exports}}]);